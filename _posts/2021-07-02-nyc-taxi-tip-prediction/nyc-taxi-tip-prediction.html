<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>What Factors Influence Taxi Tipping</title>

  <meta property="description" itemprop="description" content="Perform exploratory data analysis and build ensemble learning models to predict taxi tip amount based on other trip information, geography location and timestamp data."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-07-01"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-07-01"/>
  <meta name="article:author" content="LIU Yangguang"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="What Factors Influence Taxi Tipping"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Perform exploratory data analysis and build ensemble learning models to predict taxi tip amount based on other trip information, geography location and timestamp data."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="What Factors Influence Taxi Tipping"/>
  <meta property="twitter:description" content="Perform exploratory data analysis and build ensemble learning models to predict taxi tip amount based on other trip information, geography location and timestamp data."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","categories","preview"]}},"value":[{"type":"character","attributes":{},"value":["What Factors Influence Taxi Tipping"]},{"type":"character","attributes":{},"value":["Perform exploratory data analysis and build ensemble learning models to predict taxi tip amount based on other trip information, geography location and timestamp data.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["LIU Yangguang"]},{"type":"character","attributes":{},"value":["https://www.linkedin.com/in/ygliu/"]},{"type":"character","attributes":{},"value":["School of Computing and Information Systems, Singapore Management University"]}]}]},{"type":"character","attributes":{},"value":["07-01-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]}]}]},{"type":"character","attributes":{},"value":["Python","Machine Learning"]},{"type":"character","attributes":{},"value":["bg.png"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bg.png","con_fea.csv","img/boxplot.png","img/date_range.png","img/distribution_cate.png","img/distribution_num.png","img/geo.png","nyc-taxi-tip-prediction_files/anchor-4.2.2/anchor.min.js","nyc-taxi-tip-prediction_files/bowser-1.9.3/bowser.min.js","nyc-taxi-tip-prediction_files/distill-2.2.21/template.v2.js","nyc-taxi-tip-prediction_files/header-attrs-2.7/header-attrs.js","nyc-taxi-tip-prediction_files/jquery-1.11.3/jquery.min.js","nyc-taxi-tip-prediction_files/kePrint-0.0.1/kePrint.js","nyc-taxi-tip-prediction_files/lightable-0.0.1/lightable.css","nyc-taxi-tip-prediction_files/popper-2.6.0/popper.min.js","nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy-bundle.umd.min.js","nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy-light-border.css","nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy.css","nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy.umd.min.js","nyc-taxi-tip-prediction_files/webcomponents-2.0.0/webcomponents.js","nyc_taxi_tip_code.html","row_with_missing.html","taxi_5_row.csv"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="nyc-taxi-tip-prediction_files/header-attrs-2.7/header-attrs.js"></script>
  <script src="nyc-taxi-tip-prediction_files/kePrint-0.0.1/kePrint.js"></script>
  <link href="nyc-taxi-tip-prediction_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="nyc-taxi-tip-prediction_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="nyc-taxi-tip-prediction_files/popper-2.6.0/popper.min.js"></script>
  <link href="nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="nyc-taxi-tip-prediction_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="nyc-taxi-tip-prediction_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="nyc-taxi-tip-prediction_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="nyc-taxi-tip-prediction_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="nyc-taxi-tip-prediction_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"What Factors Influence Taxi Tipping","description":"Perform exploratory data analysis and build ensemble learning models to predict taxi tip amount based on other trip information, geography location and timestamp data.","authors":[{"author":"LIU Yangguang","authorURL":"https://www.linkedin.com/in/ygliu/","affiliation":"School of Computing and Information Systems, Singapore Management University","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-07-01T00:00:00.000+08:00","citationText":"Yangguang, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>What Factors Influence Taxi Tipping</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">Python</div>
<div class="dt=tag">Machine Learning</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>Perform exploratory data analysis and build ensemble learning models to predict taxi tip amount based on other trip information, geography location and timestamp data.</p></p>
</div>

<div class="d-byline">
  LIU Yangguang <a href="https://www.linkedin.com/in/ygliu/" class="uri">https://www.linkedin.com/in/ygliu/</a> (School of Computing and Information Systems, Singapore Management University)
  
<br/>07-01-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data-exploration">Data Exploration</a>
<ul>
<li><a href="#dataset">Dataset</a></li>
<li><a href="#data-exploration-1">Data Exploration</a></li>
</ul></li>
<li><a href="#feature-engineering">Feature Engineering</a></li>
<li><a href="#model">Model</a>
<ul>
<li><a href="#model-building">Model Building</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
<li><a href="#future-work">Future Work</a></li>
</ul>
</nav>
</div>
<style> /* A floating TOC, but it's not suitable for long TOC*/
html {
  scroll-behavior: smooth;
}
d-article {
    contain: none;
    overflow-x: hidden;
  }
#TOC {
  position: fixed; /* float will make the toc fixed */
  z-index: 50; /* priority when the elements overlap each other  */
  background: white;     /* or#ebebeb; */
  /* optional padding: 10px; border-radius: 5px; */
  }

/* Hide the ToC when resized to mobile or tablet:  480px, 768px, 900px */
@media screen and (max-width: 900px) { /* change from 900 */
#TOC {
    position: relative;
  }
}
</style>
<h2 id="introduction">Introduction</h2>
<p>The taxi fare amount is decided by trip distance, pickup time and so on. It has a built-in calculation formula and is transparent to the public. But the tip amount doesn’t have any fixed rule, which seems to be mostly affected by the qualitative features, such as passengers’ mood and drivers’ service and friendliness.</p>
<p>The objective of this study is to build predictive models to predict what factors will influence the taxi tip amount. It would help taxi drivers and online ride-hailing platforms to figure out the important factors and add the revenue.</p>
<p>The python code was written in the jupyter notebook and can be found <a href="nyc_taxi_tip_code.html">here</a></p>
<h2 id="data-exploration">Data Exploration</h2>
<h3 id="dataset">Dataset</h3>
<p>The dataset originates from New York City <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">Taxi and Limousine Commission (TLC)</a>. It has 1,071,910 samples and 14 features. And each sample/row represents a trip.</p>
<p>First, import the data and take a quick peek at how the data looks like.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
vendor_id
</th>
<th style="text-align:left;">
pickup_datetime
</th>
<th style="text-align:left;">
dropoff_datetime
</th>
<th style="text-align:right;">
pickup_longitude
</th>
<th style="text-align:right;">
pickup_latitude
</th>
<th style="text-align:right;">
dropoff_longitude
</th>
<th style="text-align:right;">
dropoff_latitude
</th>
<th style="text-align:right;">
rate_code
</th>
<th style="text-align:right;">
passenger_count
</th>
<th style="text-align:right;">
trip_distance
</th>
<th style="text-align:left;">
payment_type
</th>
<th style="text-align:right;">
fare_amount
</th>
<th style="text-align:right;">
tip_amount
</th>
<th style="text-align:right;">
tip_paid
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2013-11-03 18:11:18+00:00
</td>
<td style="text-align:left;">
2013-11-03 18:18:43+00:00
</td>
<td style="text-align:right;">
-73.97188
</td>
<td style="text-align:right;">
40.75623
</td>
<td style="text-align:right;">
-73.97143
</td>
<td style="text-align:right;">
40.76418
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:left;">
CSH
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2010-06-30 17:30:34+00:00
</td>
<td style="text-align:left;">
2010-06-30 17:40:44+00:00
</td>
<td style="text-align:right;">
-73.97785
</td>
<td style="text-align:right;">
40.73836
</td>
<td style="text-align:right;">
-73.97707
</td>
<td style="text-align:right;">
40.75423
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.50
</td>
<td style="text-align:left;">
Cre
</td>
<td style="text-align:right;">
6.9
</td>
<td style="text-align:right;">
1.88
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
CMT
</td>
<td style="text-align:left;">
2010-03-03 10:10:25+00:00
</td>
<td style="text-align:left;">
2010-03-03 10:19:38+00:00
</td>
<td style="text-align:right;">
-73.97409
</td>
<td style="text-align:right;">
40.76248
</td>
<td style="text-align:right;">
-73.99067
</td>
<td style="text-align:right;">
40.74567
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.60
</td>
<td style="text-align:left;">
Cre
</td>
<td style="text-align:right;">
6.9
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
VTS
</td>
<td style="text-align:left;">
2012-04-17 11:51:00+00:00
</td>
<td style="text-align:left;">
2012-04-17 12:07:00+00:00
</td>
<td style="text-align:right;">
-73.97992
</td>
<td style="text-align:right;">
40.78104
</td>
<td style="text-align:right;">
-73.97042
</td>
<td style="text-align:right;">
40.76561
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.70
</td>
<td style="text-align:left;">
CRD
</td>
<td style="text-align:right;">
9.7
</td>
<td style="text-align:right;">
1.94
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
VTS
</td>
<td style="text-align:left;">
2012-03-30 14:26:00+00:00
</td>
<td style="text-align:left;">
2012-03-30 14:36:00+00:00
</td>
<td style="text-align:right;">
-73.97298
</td>
<td style="text-align:right;">
40.76161
</td>
<td style="text-align:right;">
-73.95561
</td>
<td style="text-align:right;">
40.76429
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.36
</td>
<td style="text-align:left;">
CSH
</td>
<td style="text-align:right;">
6.9
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There are some features could sound a bit strange. The <a href="https://www1.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf">TLC metadata</a> and <a href="https://www1.nyc.gov/site/tlc/passengers/taxi-fare.page">taxi fare explanation page</a> give us explanations:</p>
<ul>
<li><strong>vendor_id</strong>: the identifier of the programs that provided the data</li>
<li><strong>rate_code</strong>: the identifier of different rates due to the destination, such as trips beyond NYC or airport trips</li>
<li><strong>tip_paid</strong>: the boolean value about whether the tip was paid or not</li>
</ul>
<p>Besides, we can see that the datetime features are in UTC time zone, not the local time zone (US/East).</p>
<h3 id="data-exploration-1">Data Exploration</h3>
<h4 id="missing-value">Missing value</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raw.isnull().<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(raw))</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>Missing value percentage for each feature is:
vendor_id            0.000000
pickup_datetime      0.000000
dropoff_datetime     0.000000
pickup_longitude     0.000000
pickup_latitude      0.000000
dropoff_longitude    0.000000
dropoff_latitude     0.000000
rate_code            0.161596
passenger_count      0.000000
trip_distance        0.000000
payment_type         0.000000
fare_amount          0.000000
tip_amount           0.000000
tip_paid             0.000000
dtype: float64
0.16159565635174594</code></pre>
</div>
<p>There is null values only in ‘rate_code’ and the missing value percentage is significant that we can’t just removes these rows with missing values but need to replace them.</p>
<h4 id="check-distributions">Check Distributions</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>raw.info() </span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>RangeIndex: 1071910 entries, 0 to 1071909
Data columns (total 14 columns):
 #   Column             Non-Null Count    Dtype  
---  ------             --------------    -----  
 0   vendor_id          1071910 non-null  object 
 1   pickup_datetime    1071910 non-null  object 
 2   dropoff_datetime   1071910 non-null  object 
 3   pickup_longitude   1071910 non-null  float64
 4   pickup_latitude    1071910 non-null  float64
 5   dropoff_longitude  1071910 non-null  float64
 6   dropoff_latitude   1071910 non-null  float64
 7   rate_code          898694 non-null   float64
 8   passenger_count    1071910 non-null  int64  
 9   trip_distance      1071910 non-null  float64
 10  payment_type       1071910 non-null  object 
 11  fare_amount        1071910 non-null  float64
 12  tip_amount         1071910 non-null  float64
 13  tip_paid           1071910 non-null  int64  
dtypes: float64(8), int64(2), object(4)
memory usage: 114.5+ MB</code></pre>
</div>
<p>There are 4 categorical features and 10 numerical features. But we know that ‘rate_code’ is an identifier thus a categorical feature.</p>
<h5 id="categorical-features">Categorical Features</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>category_fea <span class="op">=</span> [<span class="st">&#39;vendor_id&#39;</span>, <span class="st">&#39;payment_type&#39;</span>, <span class="st">&#39;rate_code&#39;</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">100</span>, <span class="dv">30</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    se <span class="op">=</span> raw[category_fea[i]].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> [<span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> se.index]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="bu">list</span>(se.values)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> ax[i].barh(x,y)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    ax[i].tick_params(labelsize<span class="op">=</span><span class="dv">70</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(category_fea[i], fontsize<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    ax[i].xaxis.set_ticks(np.linspace(<span class="dv">0</span>,<span class="dv">800000</span>,<span class="dv">3</span>))</span></code></pre></div>
</div>
<p><img src="img/distribution_cate.png" /></p>
<p>We can find that there are many long tail value in the ‘payment_type’ and ‘rate_code’. Only one or two values dominate the feature. They need to be bucketized later to avoid extremely unbalanced distributions.</p>
<p>And for the ‘payment_type’. It has some different values with the same meaning. Like ‘Cre’ and ‘CRE’ both refer to the credit card payment. ‘CAS’ and ‘Cas’ both refer to the cash payment.</p>
<p>Besides, we don’t plot the two datetime features here because they are the combination of date and time and have hundreds of thousands unique values. The distribution will be displayed after the data transformation.</p>
<h5 id="numerical-features">Numerical Features</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>numerical_fea <span class="op">=</span> [<span class="st">&#39;pickup_longitude&#39;</span>, <span class="st">&#39;pickup_latitude&#39;</span>, <span class="st">&#39;dropoff_longitude&#39;</span>, <span class="st">&#39;dropoff_latitude&#39;</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;passenger_count&#39;</span>, <span class="st">&#39;trip_distance&#39;</span>, <span class="st">&#39;fare_amount&#39;</span>, <span class="st">&#39;tip_amount&#39;</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> pd.melt(raw, value_vars<span class="op">=</span>numerical_fea) <span class="co"># melt the col</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(f, col<span class="op">=</span><span class="st">&quot;variable&quot;</span>,  col_wrap<span class="op">=</span><span class="dv">4</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> g.<span class="bu">map</span>(sns.histplot, <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
</div>
<p><img src="img/distribution_num.png" /> The four latitude and longitude features approximately follow normal distributions, but we can’t put them into the model without processing. The locations, which can be regard as binning of geography features, are more important than values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>raw[[<span class="st">&#39;trip_distance&#39;</span>,<span class="st">&#39;fare_amount&#39;</span>,<span class="st">&#39;tip_amount&#39;</span>]].describe(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    percentiles<span class="op">=</span>[<span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.99</span>, <span class="fl">.999</span>])</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
trip_distance
</th>
<th style="text-align:right;">
fare_amount
</th>
<th style="text-align:right;">
tip_amount
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
count
</td>
<td style="text-align:right;">
1.071910e+06
</td>
<td style="text-align:right;">
1.071910e+06
</td>
<td style="text-align:right;">
1.071910e+06
</td>
</tr>
<tr>
<td style="text-align:left;">
mean
</td>
<td style="text-align:right;">
1.812045e+00
</td>
<td style="text-align:right;">
8.456763e+00
</td>
<td style="text-align:right;">
7.843356e-01
</td>
</tr>
<tr>
<td style="text-align:left;">
std
</td>
<td style="text-align:right;">
1.221569e+00
</td>
<td style="text-align:right;">
4.017411e+00
</td>
<td style="text-align:right;">
1.190242e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
min
</td>
<td style="text-align:right;">
1.000000e-02
</td>
<td style="text-align:right;">
2.500000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
25%
</td>
<td style="text-align:right;">
9.500000e-01
</td>
<td style="text-align:right;">
5.700000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
50%
</td>
<td style="text-align:right;">
1.500000e+00
</td>
<td style="text-align:right;">
7.500000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
75%
</td>
<td style="text-align:right;">
2.300000e+00
</td>
<td style="text-align:right;">
1.010000e+01
</td>
<td style="text-align:right;">
1.500000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
99%
</td>
<td style="text-align:right;">
6.090000e+00
</td>
<td style="text-align:right;">
2.150000e+01
</td>
<td style="text-align:right;">
4.300000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
99.90%
</td>
<td style="text-align:right;">
8.700000e+00
</td>
<td style="text-align:right;">
3.150000e+01
</td>
<td style="text-align:right;">
7.000000e+00
</td>
</tr>
<tr>
<td style="text-align:left;">
max
</td>
<td style="text-align:right;">
1.680000e+01
</td>
<td style="text-align:right;">
2.000000e+02
</td>
<td style="text-align:right;">
1.444000e+02
</td>
</tr>
</tbody>
</table>
</div>
<p>And ‘trip_distance’, ‘fare_amount’ and ‘tip_amount’ all have extremely outliers. Take ‘tip_amount’ as an example, 99.9% values are less than 7, but the max value reaches 144.4. It’s the same situation with ‘trip_amount’ and ‘fare_amount’. Because this study will focus on how much the tip amount would be in the general situation instead of the extreme situations, these outliers will be excluded later.</p>
<h2 id="feature-engineering">Feature Engineering</h2>
<h4 id="missing-value-1">Missing value</h4>
<p>We can take a look at the rows with missing value by the handy function below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas_profiling</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df_null <span class="op">=</span> raw.iloc[<span class="bu">list</span>(raw[<span class="st">&#39;rate_code&#39;</span>].isnull()),:] <span class="co"># filter out the rows with missing value</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>report <span class="op">=</span> pandas_profiling.ProfileReport(df_null)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>report.to_widgets()</span></code></pre></div>
</div>
<p>The result can be found <a href="row_with_missing.html">here</a>. But there is nothing special about the feature distribution in these rows. Thus, we would not process from rows.</p>
<p>We can only replace the missing value from its distribution. Because one value take the majority, we will group the missing value and other values into one group.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>raw[<span class="st">&#39;rate_code_group&#39;</span>] <span class="op">=</span> raw[<span class="st">&#39;rate_code&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x:<span class="st">&#39;1&#39;</span> <span class="cf">if</span> x <span class="op">==</span> <span class="fl">1.0</span> <span class="cf">else</span> <span class="st">&#39;Others&#39;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check the new distribution</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(raw[<span class="st">&#39;rate_code_group&#39;</span>].value_counts())</span></code></pre></div>
</div>
<div class="layout-chunk" data-layout="l-body">
<pre><code>1         896903
Others    175007
Name: rate_code_group, dtype: int64</code></pre>
</div>
<h4 id="outliers">Outliers</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw the box plot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fig,ax2 <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">&quot;trip_distance&quot;</span>, data<span class="op">=</span>raw, ax<span class="op">=</span>ax2[<span class="dv">0</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">&quot;fare_amount&quot;</span>,  data<span class="op">=</span>raw, ax<span class="op">=</span>ax2[<span class="dv">1</span>])</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">&quot;tip_amount&quot;</span>, data<span class="op">=</span>raw, ax<span class="op">=</span>ax2[<span class="dv">2</span>])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># clean outliers</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> (raw[<span class="st">&#39;tip_amount&#39;</span>] <span class="op">&lt;</span> <span class="dv">30</span>) <span class="op">&amp;</span> (raw[<span class="st">&#39;fare_amount&#39;</span>] <span class="op">&lt;</span> <span class="dv">60</span>) <span class="op">&amp;</span> (raw[<span class="st">&#39;trip_distance&#39;</span>] <span class="op">&lt;</span> <span class="fl">12.5</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>raw_clean <span class="op">=</span> raw.loc[idx]</span></code></pre></div>
</div>
<p><img src="img/boxplot.png" /></p>
<p>We excluded 83 extreme outlier samples out of the 1 million raw data. It will help improve the model performance as well as robustness.</p>
<h4 id="datetime">Datetime</h4>
<p>The datetime features are transformed from string to datetime and switch to the local timezone in the New York. Thus we can get the real datetime data. We can find that the date cover from 2009 to 2015.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the string into datetime</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> dt: datetime.strptime(dt, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S%z&quot;</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert time zone</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>us_east <span class="op">=</span> timezone(<span class="st">&#39;US/Eastern&#39;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> dt: dt.astimezone(us_east))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># do the same transformation for dropoff datetime</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;dropoff_datetime&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;dropoff_datetime&#39;</span>].<span class="bu">apply</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> dt: datetime.strptime(dt, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S%z&quot;</span>))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;dropoff_datetime&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;dropoff_datetime&#39;</span>].<span class="bu">apply</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> dt: dt.astimezone(us_east))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the date distribution</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>time_date <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> dt: dt.date)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>time_date_count <span class="op">=</span> time_date.value_counts().reset_index().sort_values(by<span class="op">=</span><span class="st">&#39;index&#39;</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span><span class="st">&#39;index&#39;</span>, y<span class="op">=</span><span class="st">&#39;pickup_datetime&#39;</span>, data<span class="op">=</span>time_date_count)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>plt.gcf().autofmt_xdate() <span class="co"># format the date x-axis</span></span></code></pre></div>
</div>
<p><img src="img/date_range.png" /></p>
<p>Instead of using these datetime features, we need to extract some new features from them to put in models:</p>
<ul>
<li><strong>pickup_hour</strong>: The number of hour when the pickup happened (24 hour-hour clock)</li>
<li><strong>pickup_weekday</strong>: The weekday name when the pickup happened</li>
<li><strong>pickup_month</strong>: The month name when the pickup happened</li>
<li><strong>pickup_year</strong>: The year number when the pickup happened</li>
<li><strong>min_period</strong>: The minutes between pickup time and dropoff time</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the hour number of pickup time</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_hour&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> dt: <span class="bu">int</span>(dt.hour))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the weekday</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_weekday&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> dt: dt.strftime(<span class="st">&quot;%A&quot;</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the month of the year</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_month&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> dt: dt.strftime(<span class="st">&quot;%b&quot;</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get the year</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_year&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> dt: <span class="bu">str</span>(dt.year))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get the time period (minitues) between pickup and dropoff</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>timeperiod <span class="op">=</span> raw_clean[<span class="st">&#39;dropoff_datetime&#39;</span>] <span class="op">-</span> raw_clean[<span class="st">&#39;pickup_datetime&#39;</span>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;min_period&#39;</span>] <span class="op">=</span> timeperiod.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">float</span>(x.seconds<span class="op">/</span><span class="dv">60</span>))</span></code></pre></div>
</div>
<h4 id="geography-features">Geography Features</h4>
<p>We can draw the scatter plot between longitude and latitude.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig, ax4 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">100</span>, <span class="dv">100</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ax4.scatter(<span class="st">&#39;pickup_longitude&#39;</span>, <span class="st">&#39;pickup_latitude&#39;</span>, data<span class="op">=</span>raw_clean, s<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ax4.scatter(<span class="st">&#39;dropoff_longitude&#39;</span>, <span class="st">&#39;dropoff_latitude&#39;</span>, data<span class="op">=</span>raw_clean, s<span class="op">=</span><span class="dv">5</span>, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div>
</div>
<p><img src="img/geo.png" /></p>
<p>The high density area is Manhattan actually. The points seems to draw many grids, which might corresponds to the building. It would be a good idea to name the geography location into the corresponding neighborhood. But that need much more computation resource and dataset. Here we take a simple but still useful method: bin the longitude and latitude.</p>
<h4 id="binning">Binning</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bucketize longgitude &amp; lagitude by percentile</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_lo_cut&#39;</span>] <span class="op">=</span> pd.cut(raw_clean[<span class="st">&#39;pickup_longitude&#39;</span>], <span class="dv">20</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_la_cut&#39;</span>] <span class="op">=</span> pd.cut(raw_clean[<span class="st">&#39;pickup_latitude&#39;</span>], <span class="dv">20</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;dropoff_lo_cut&#39;</span>] <span class="op">=</span> pd.cut(raw_clean[<span class="st">&#39;dropoff_longitude&#39;</span>], <span class="dv">20</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;dropoff_la_cut&#39;</span>] <span class="op">=</span> pd.cut(raw_clean[<span class="st">&#39;dropoff_latitude&#39;</span>], <span class="dv">20</span>)</span></code></pre></div>
</div>
<p>We bucketize the four geography feature into 20 bins.</p>
<p>And the ‘payment_type’ also need to be bucketing since it has long tail values.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine &#39;Cre&#39; and &#39;CRE&#39;, &#39;Cas&#39; and &#39;CAS&#39;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;payment_type_group&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;payment_type&#39;</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">str</span>.upper(x))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the minor into one group</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;payment_type_group&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;payment_type_group&#39;</span>] <span class="op">=</span> raw_clean[<span class="st">&#39;payment_type_group&#39;</span>].<span class="bu">apply</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="st">&#39;Other&#39;</span> <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="st">&#39;CSH&#39;</span>,<span class="st">&#39;CRD&#39;</span>,<span class="st">&#39;CAS&#39;</span>,<span class="st">&#39;CRE&#39;</span>] <span class="cf">else</span> x)</span></code></pre></div>
</div>
<p>Besides, the ‘pickup_hour’ should be divided into groups as well. Here we bin 24 hours into 4 time period: ‘Midnight’(0-6), ‘Morning’(6-12), ‘Afternoon’(12-18), ‘Evening’(18-23)</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group the pickup hour</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">18</span>, <span class="dv">23</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>raw_clean[<span class="st">&#39;pickup_hour_group&#39;</span>] <span class="op">=</span> pd.cut(raw_clean[<span class="st">&#39;pickup_hour&#39;</span>], bins, include_lowest <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                        labels<span class="op">=</span>[<span class="st">&#39;Midnight&#39;</span>, <span class="st">&#39;Morning&#39;</span>, <span class="st">&#39;Afternoon&#39;</span>, <span class="st">&#39;Evening&#39;</span>])</span></code></pre></div>
</div>
<p>After these data transformation, we can exclude some old features and keep the new features extracted from them. Then we can get a new dataset with 16 features.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>drop_list <span class="op">=</span> [<span class="st">&#39;pickup_datetime&#39;</span>, <span class="st">&#39;dropoff_datetime&#39;</span>, <span class="st">&#39;pickup_longitude&#39;</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;pickup_latitude&#39;</span>, <span class="st">&#39;dropoff_longitude&#39;</span>, <span class="st">&#39;dropoff_latitude&#39;</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;rate_code&#39;</span>, <span class="st">&#39;payment_type&#39;</span>, <span class="st">&#39;pickup_hour&#39;</span>, <span class="st">&#39;tip_paid&#39;</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>raw_clean <span class="op">=</span> raw_clean.drop(drop_list, axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<p>The last step before modelling is to perform one-hot encoding for categorical variables:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dummy_list <span class="op">=</span> [<span class="st">&#39;vendor_id&#39;</span>, <span class="st">&#39;rate_code_group&#39;</span>, <span class="st">&#39;pickup_hour_group&#39;</span>, <span class="st">&#39;pickup_weekday&#39;</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;pickup_month&#39;</span>, <span class="st">&#39;pickup_year&#39;</span>, <span class="st">&#39;pickup_lo_cut&#39;</span>, <span class="st">&#39;pickup_la_cut&#39;</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;dropoff_lo_cut&#39;</span>, <span class="st">&#39;dropoff_la_cut&#39;</span>, <span class="st">&#39;payment_type_group&#39;</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>raw_clean_dummy <span class="op">=</span> pd.get_dummies(raw_clean, columns<span class="op">=</span>dummy_list, drop_first<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<h2 id="model">Model</h2>
<h3 id="model-building">Model Building</h3>
<p>The linear regression would not perform well since the distribution of the independent features and target feature. Thus, We will use a decision tree as our base model. And ensemble learning models based on the decision tree will be built to make comparison. The objective metrics is root-mean-square error (<a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">RMSE</a>).</p>
<p>First, the cleansed data are split into train data and test data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    raw_clean_dummy.drop([<span class="st">&#39;tip_amount&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>), raw_clean_dummy[<span class="st">&#39;tip_amount&#39;</span>], test_size<span class="op">=</span><span class="fl">0.2</span>)</span></code></pre></div>
</div>
<p>The base model is decision tree regressor. The calculated RMSE on the test data is 0.6747.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> DecisionTreeRegressor(criterion<span class="op">=</span><span class="st">&#39;mse&#39;</span>, min_samples_leaf <span class="op">=</span> <span class="dv">3</span>, random_state <span class="op">=</span> <span class="dv">2021</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> base.fit(x_train, y_train)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>base_pred <span class="op">=</span> dt.predict(x_test)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>base_rmse <span class="op">=</span> metrics.mean_squared_error(base_pred, y_test, squared <span class="op">=</span> <span class="va">False</span>)</span></code></pre></div>
</div>
<p>The ensemble learning models we use are Random Forest, AdaBoost and Gradient Boosting. To get the optimal hyperparameter combination, we will split the train data into the train and the validation. And the KFold cross validation is used in hyperparameter tuning because it can ensure more “trustable” estimation.</p>
<p>The hyperparameters chosen to test are mostly related to the model complexity. The complexity model might not always get better performance. So we want to test and get the optimal model with different complexity.</p>
<h4 id="random-forest"><strong>Random Forest</strong></h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 fold cross validation</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cv_fold <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">2021</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># RandomForestRegressor</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>model_rf <span class="op">=</span> ensemble.RandomForestRegressor()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the hyperparameter range to tune</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>para_rf <span class="op">=</span> {<span class="st">&quot;n_estimators&quot;</span>: [<span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>],</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;max_depth&quot;</span>: <span class="bu">range</span>(<span class="dv">4</span>,<span class="dv">11</span>,<span class="dv">1</span>),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;min_samples_split&quot;</span>: <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">11</span>,<span class="dv">1</span>)} </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparameter tunning</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>rf_randomd_search <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>model_rf,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                                       cv<span class="op">=</span>cv_fold,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                                       n_iter <span class="op">=</span> <span class="dv">5</span>, </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                                       param_distributions<span class="op">=</span> para_rf,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                                       scoring<span class="op">=</span><span class="st">&#39;neg_root_mean_squared_error&#39;</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                                       n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>) <span class="co"># use all processors</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the train data</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf_randomd_search.fit(x_train, y_train)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model again with the calculated best parameters</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>rf_best_para <span class="op">=</span> rf.best_params_</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>rf_best <span class="op">=</span> ensemble.RandomForestRegressor(n_estimators <span class="op">=</span> rf_best_para[<span class="st">&quot;n_estimators&quot;</span>],</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                                         max_depth <span class="op">=</span> rf_best_para[<span class="st">&quot;max_depth&quot;</span>],</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                                         min_samples_split <span class="op">=</span> rf_best_para[<span class="st">&#39;min_samples_split&#39;</span>],</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>                                         random_state <span class="op">=</span> <span class="dv">2021</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>rf_best.fit(x_train, y_train)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># predict on the test data</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="op">=</span> rf_best.predict(x_test)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the RMSE</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>rf_rmse <span class="op">=</span> metrics.mean_squared_error(y_test, rf_pred, squared <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;The RMSE of RandomForestRegressor on the test data is&#39;</span>, rf_rmse)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 5 important feature</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> x_train.columns</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>rf_fea_importance <span class="op">=</span> rf_best.feature_importances_</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>rf_index <span class="op">=</span> np.argsort(rf_fea_importance)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;No.</span><span class="sc">{i</span><span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>col[rf_index[i]]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
</div>
<h4 id="adaboost"><strong>AdaBoost</strong></h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model_ada <span class="op">=</span> ensemble.AdaBoostRegressor()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the hyperparameter range to be test</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>para_ada <span class="op">=</span> {<span class="st">&quot;n_estimators&quot;</span>: [<span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>],</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;learning_rate&quot;</span>: [<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>]}</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparameter tunning</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>ada_randomd_search <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>model_ada,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                                        cv<span class="op">=</span>cv_fold,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                                        n_iter <span class="op">=</span> <span class="dv">5</span>, </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>                                        param_distributions<span class="op">=</span> para_ada,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                                        scoring<span class="op">=</span><span class="st">&#39;neg_root_mean_squared_error&#39;</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                                        n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the train data</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>ada <span class="op">=</span> ada_randomd_search.fit(x_train, y_train)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model again with the calculated best parameters</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>ada_best_para <span class="op">=</span> ada.best_params_</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>ada_best <span class="op">=</span> ensemble.AdaBoostRegressor(n_estimators <span class="op">=</span> ada_best_para[<span class="st">&quot;n_estimators&quot;</span>],</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                                      learning_rate <span class="op">=</span> ada_best_para[<span class="st">&quot;learning_rate&quot;</span>],</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                                      random_state<span class="op">=</span><span class="dv">2021</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>ada_best.fit(x_train, y_train)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># predict on the test data</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>ada_pred <span class="op">=</span> ada_best.predict(x_test)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the RMSE</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>ada_rmse <span class="op">=</span> metrics.mean_squared_error(y_test, ada_pred, squared <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;The RMSE of AdaBoostRegressor on the test data is&#39;</span>, ada_rmse)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 5 important feature</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>ada_fea_importance <span class="op">=</span> ada_best.feature_importances_</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>ada_index <span class="op">=</span> np.argsort(ada_fea_importance)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;No.</span><span class="sc">{i</span><span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>col[ada_index[i]]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
</div>
<h4 id="gradientboosting"><strong>GradientBoosting</strong></h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_gbr <span class="op">=</span> ensemble.GradientBoostingRegressor()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the hyperparameter range to be test</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>pare_gbr <span class="op">=</span> {<span class="st">&quot;loss&quot;</span>: [<span class="st">&#39;ls&#39;</span>, <span class="st">&#39;lad&#39;</span>, <span class="st">&#39;huber&#39;</span>],</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;n_estimators&quot;</span>: [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>],</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;learning_rate&quot;</span>: [<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>],</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;min_samples_split&quot;</span>: [<span class="dv">4</span>,<span class="dv">8</span>]}</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparameter tunning</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>gbr_randomd_search <span class="op">=</span> RandomizedSearchCV(estimator<span class="op">=</span>model_gbr,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                                        cv<span class="op">=</span>cv_fold,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                                        n_iter <span class="op">=</span> <span class="dv">5</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                                        param_distributions<span class="op">=</span> pare_gbr,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                                        scoring<span class="op">=</span><span class="st">&#39;neg_root_mean_squared_error&#39;</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                                        n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the train data</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>gbr <span class="op">=</span> gbr_randomd_search.fit(x_train, y_train)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model again with the calculated best parameters</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>gbr_best_para <span class="op">=</span> gbr.best_params_</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>gbr_best <span class="op">=</span> ensemble.GradientBoostingRegressor(loss <span class="op">=</span> gbr_best_para[<span class="st">&quot;loss&quot;</span>],</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>                                              n_estimators <span class="op">=</span> gbr_best_para[<span class="st">&quot;n_estimators&quot;</span>],</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                                              learning_rate <span class="op">=</span> gbr_best_para[<span class="st">&quot;learning_rate&quot;</span>],</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>                                              min_samples_split <span class="op">=</span> gbr_best_para[<span class="st">&quot;min_samples_split&quot;</span>],</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>                                              random_state <span class="op">=</span> <span class="dv">2021</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>gbr_best.fit(x_train, y_train)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co"># predict on the test data</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>gbr_pred <span class="op">=</span> gbr_best.predict(x_test)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the RMSE</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>gbr_rmse <span class="op">=</span> metrics.mean_squared_error(y_test, gbr_pred, squared <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;The RMSE of GradientBoostingRegressor on the test data is&#39;</span>, gbr_rmse)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the top 5 important feature</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>gbr_rea_importance <span class="op">=</span> gbr_best.feature_importances_</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>gbr_index <span class="op">=</span> np.argsort(gbr_rea_importance)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;No.</span><span class="sc">{i</span><span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>col[gbr_index[i]]<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
</div>
<h3 id="conclusion">Conclusion</h3>
<p>The model performance on the test data is below:</p>
<table>
<thead>
<tr class="header">
<th><strong>Classifier</strong></th>
<th><strong>Decidion Tree</strong></th>
<th><strong>RandomForest</strong></th>
<th><strong>AdaBoost</strong></th>
<th><strong>GradientBoosting</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>RMSE</strong></td>
<td>0.6747</td>
<td>0.5317</td>
<td>0.6182</td>
<td>0.5322</td>
</tr>
</tbody>
</table>
<p>We can find that the overall three ensemble learning models reduce the RMSE compared with the base model. And Random Forest is the best with the 0.5317 on RMSE, while the gradient boosting performs nearly well.</p>
<p>Furthermore, we print the five most important features in the three models:</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Classifier</strong></th>
<th><strong>RandomForest</strong></th>
<th><strong>AdaBoost</strong></th>
<th><strong>GradientBoosting</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Feature 1</td>
<td>payment_type_group_CRD</td>
<td>payment_type_group_CRD</td>
<td>payment_type_group_CRD</td>
</tr>
<tr class="even">
<td>Feature 2</td>
<td>fare_amount</td>
<td>fare_amount</td>
<td>fare_amount</td>
</tr>
<tr class="odd">
<td>Feature 3</td>
<td>payment_type_group_CRE</td>
<td>trip_distance</td>
<td>payment_type_group_CRE</td>
</tr>
<tr class="even">
<td>Feature 4</td>
<td>min_period</td>
<td>payment_type_group_CRE</td>
<td>min_period</td>
</tr>
<tr class="odd">
<td>Feature 5</td>
<td>vendor_id_VTS</td>
<td>payment_type_group_CSH</td>
<td>payment_type_group_Other</td>
</tr>
</tbody>
</table>
<p>Surprisingly, the top two important features are the same in the three models. Whether the taxi trip is paid by ‘CRD’ is the most important. And the ‘fare_amount’ is the second important. It implies that the tip amount would be bigger if the fare amount is bigger and the payment type is ‘CRD’.</p>
<p>Besides, different payment type has different influence on the tip amount but many but all payment types are very important in models.</p>
<p>And the ‘min_period’ and ‘trip_distance’ are important as well. They can be explained as the same with ‘fare_amount’. A longer trip in distance or driving time will usually have a larger fare amount. And such trip will get a larger tip amount.</p>
<h2 id="future-work">Future Work</h2>
<p>This study is based on my assignment in the machine learning course. There are many parts to improve when time is enough:</p>
<ul>
<li><p>The geography features were simply binning. But a better processing approach can be combine the latitude and longitude to get the real neighborhoods and we would find which specific area are more likely to get a higher tip amount</p></li>
<li><p>The date features can consider the holiday date, which intuitively is an important feature in tipping . It need to manually collect the holiday data from 2009 to 2015 because there is complete datasets with one-click</p></li>
<li><p>The business analysis part is brief. It’s partially because the dataset provided in class has minor difference with the dataset in New York City TLC. And the metadata cannot correspond completely and some values of features don’t have definition</p></li>
<li><p>The EDA can explore more about the relationships between trip features and the tipping</p></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
